<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Åiveli Ses TanÄ±ma ve Ã‡eviri</title>
<!-- Tailwind CSS CDN'i eklendi -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
  /* Inter font varsayÄ±lan olarak Tailwind tarafÄ±ndan kullanÄ±lmaz, Ã¶zel bir font ailesi ekleyelim */
  body {
    font-family: 'Inter', sans-serif;
  }
  /* Ekstra kÃ¼Ã§Ã¼k ekranlar iÃ§in yazÄ± boyutu ayarÄ± */
  @media (max-width: 640px) {
    h1 {
      font-size: 2rem; /* text-3xl */
    }
  }
</style>
</head>
<body class="bg-gray-100 p-4 min-h-screen flex items-center justify-center">
  <div class="container bg-white shadow-lg rounded-xl p-6 md:p-8 w-full max-w-4xl">
    <!-- BaÅŸlÄ±k -->
    <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mb-6">Åiveli Ses TanÄ±ma ve Ã‡eviri</h1>

    <div class="flex flex-col md:flex-row gap-6 md:gap-8 justify-center">
      <!-- Ses TanÄ±ma ve Ã‡eviri Kutusu -->
      <div class="flex-1 min-w-[300px] bg-blue-50 p-6 rounded-xl shadow-md border border-blue-200">
        <h2 class="text-xl font-semibold text-blue-800 mb-4">Ses ile Ã‡eviri</h2>
        <!-- KayÄ±t BaÅŸlat Butonu -->
        <button id="startBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out w-full mb-3 flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.4-6 6.7V21h-2v-3.3c-3.36-.3-6-3.17-6-6.7H3c0 4.28 3.32 7.76 7.5 8.24V21h3v-2.76c4.18-.48 7.5-3.96 7.5-8.24h-2.7z"/>
          </svg>
          KayÄ±t BaÅŸlat
        </button>
        <!-- KayÄ±t Durdur Butonu -->
        <button id="stopBtn" disabled class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out w-full flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M6 6h12v12H6z"/>
          </svg>
          KayÄ±t Durdur
        </button>
        <!-- Durum MesajlarÄ± AlanÄ± -->
        <div id="status" class="mt-4 text-center font-semibold text-gray-700 min-h-[24px]"></div>

        <!-- AlgÄ±lanan (Åiveli) Metin AlanÄ± -->
        <label for="shiveliText" class="block text-gray-700 text-sm font-bold mb-2 mt-4">ğŸ—£ï¸ AlgÄ±lanan (Åiveli):</label>
        <textarea id="shiveliText" readonly class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 h-32 resize-y"></textarea>

        <!-- Ä°stanbul TÃ¼rkÃ§esi (Sesden) Metin AlanÄ± -->
        <label for="istanbulText" class="block text-gray-700 text-sm font-bold mb-2 mt-4">ğŸ“ Ä°stanbul TÃ¼rkÃ§esi (Sesden):</label>
        <textarea id="istanbulText" readonly class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-50 h-32 resize-y"></textarea>
      </div>

      <!-- Metin Ã‡eviri Kutusu -->
      <div class="flex-1 min-w-[300px] bg-green-50 p-6 rounded-xl shadow-md border border-green-200">
        <h2 class="text-xl font-semibold text-green-800 mb-4">Metin ile Ã‡eviri</h2>
        <!-- Metin GiriÅŸ AlanÄ± -->
        <label for="inputText" class="block text-gray-700 text-sm font-bold mb-2">ğŸ“ Metin Girerek Ä°stanbul TÃ¼rkÃ§esine Ã‡evir:</label>
        <textarea id="inputText" placeholder="Buraya metin girin..." class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500 h-32 resize-y"></textarea>
        <!-- Ã‡evir Butonu -->
        <button id="convertBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 ease-in-out w-full mt-4 flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93h2c0 3.31 2.69 6 6 6s6-2.69 6-6h2c0 4.08-3.05 7.44-7 7.93V12h-2v7.93z"/>
          </svg>
          Ã‡evir
        </button>

        <!-- Ã‡evrilen Metin AlanÄ± -->
        <label for="convertedText" class="block text-gray-700 text-sm font-bold mb-2 mt-4">ğŸ“ Ä°stanbul TÃ¼rkÃ§esi (Metinden):</label>
        <textarea id="convertedText" readonly class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-green-500 bg-gray-50 h-32 resize-y"></textarea>
      </div>
    </div>
  </div>

<script>
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const statusDiv = document.getElementById("status");
const shiveliText = document.getElementById("shiveliText");
const istanbulText = document.getElementById("istanbulText");
const inputText = document.getElementById("inputText");
const convertBtn = document.getElementById("convertBtn");
const convertedText = document.getElementById("convertedText");

let mediaRecorder;
let audioChunks = [];

/**
 * Mikrofon kaydÄ±nÄ± baÅŸlatÄ±r.
 * Hata durumunda veya tarayÄ±cÄ± mikrofonu desteklemiyorsa durumu gÃ¼nceller.
 */
startBtn.onclick = async () => {
  shiveliText.value = "";
  istanbulText.value = "";
  statusDiv.textContent = "ğŸ¤ KayÄ±t baÅŸlÄ±yor...";
  statusDiv.classList.remove('text-red-500'); // Ã–nceki hata rengini kaldÄ±r

  if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
    statusDiv.textContent = "âŒ TarayÄ±cÄ±nÄ±z mikrofonu desteklemiyor.";
    statusDiv.classList.add('text-red-500'); // Hata rengini ekle
    return;
  }

  try {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);

    mediaRecorder.start();
    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

    startBtn.disabled = true;
    stopBtn.disabled = false;
    statusDiv.textContent = "ğŸ¤ KayÄ±t devam ediyor... KonuÅŸmaya baÅŸlayÄ±n.";
    statusDiv.classList.remove('text-red-500');
  } catch (err) {
    statusDiv.textContent = "âŒ Mikrofon eriÅŸimi reddedildi veya bir hata oluÅŸtu: " + err.message;
    statusDiv.classList.add('text-red-500');
  }
};

/**
 * Mikrofon kaydÄ±nÄ± durdurur ve kaydedilen sesi backend'e gÃ¶nderir.
 * Sunucudan gelen cevabÄ± ilgili alanlara yazar.
 */
stopBtn.onclick = async () => {
  if (!mediaRecorder || mediaRecorder.state === "inactive") return;
  mediaRecorder.stop();
  startBtn.disabled = false;
  stopBtn.disabled = true;
  statusDiv.textContent = "ğŸ• Ses iÅŸleniyor, lÃ¼tfen bekleyin...";
  statusDiv.classList.remove('text-red-500');

  mediaRecorder.onstop = async () => {
    // Kaydedilen ses parÃ§alarÄ±nÄ± birleÅŸtirerek bir Blob oluÅŸtur
    const audioBlob = new Blob(audioChunks, { type: "audio/wav" });
    const formData = new FormData();
    formData.append("audio_data", audioBlob, "recording.wav");

    try {
      // Backend'e sesi gÃ¶nder
      const response = await fetch("/upload_audio", {
        method: "POST",
        body: formData
      });

      const data = await response.json();
      if (data.error) {
        statusDiv.textContent = "âŒ Hata: " + data.error;
        statusDiv.classList.add('text-red-500');
        return;
      }

      // Gelen verileri ekran alanlarÄ±na yaz
      shiveliText.value = data.shiveli;
      istanbulText.value = data.istanbulce;
      statusDiv.textContent = "âœ… Ä°ÅŸlem tamamlandÄ±.";
      statusDiv.classList.remove('text-red-500');
    } catch (err) {
      statusDiv.textContent = "âŒ Sunucuya baÄŸlanÄ±rken bir hata oluÅŸtu. Backend Ã§alÄ±ÅŸÄ±yor mu? " + err.message;
      statusDiv.classList.add('text-red-500');
    } finally {
      // Mikrofon akÄ±ÅŸÄ±nÄ± durdur
      if (mediaRecorder && mediaRecorder.stream) {
          mediaRecorder.stream.getTracks().forEach(track => track.stop());
      }
    }
  };
};

/**
 * Metin giriÅŸini backend'e gÃ¶nderir ve Ã§evrilmiÅŸ metni alÄ±r.
 */
convertBtn.onclick = async () => {
  const text = inputText.value.trim();
  convertedText.value = ""; // Ã–nceki Ã§eviriyi temizle
  if (!text) {
    statusDiv.textContent = "âŒ LÃ¼tfen Ã§evirmek istediÄŸiniz metni girin.";
    statusDiv.classList.add('text-red-500');
    return;
  }
  statusDiv.textContent = "ğŸ• Metin iÅŸleniyor, lÃ¼tfen bekleyin...";
  statusDiv.classList.remove('text-red-500');

  try {
    // Backend'e metni JSON olarak gÃ¶nder
    const response = await fetch("/convert_text", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await response.json();
    if (data.error) {
      statusDiv.textContent = "âŒ Hata: " + data.error;
      statusDiv.classList.add('text-red-500');
      return;
    }

    // Gelen Ã§evrilmiÅŸ metni ilgili alana yaz
    convertedText.value = data.istanbulce;
    statusDiv.textContent = "âœ… Metin Ã§evirisi tamamlandÄ±.";
    statusDiv.classList.remove('text-red-500');
  } catch (err) {
    statusDiv.textContent = "âŒ Sunucuya baÄŸlanÄ±rken bir hata oluÅŸtu. Backend Ã§alÄ±ÅŸÄ±yor mu? " + err.message;
    statusDiv.classList.add('text-red-500');
  }
};
</script>
</body>
</html>
